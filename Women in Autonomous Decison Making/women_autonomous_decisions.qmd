---
title: "Women Making Autonomous Decisons"
author: "Midega George"
format: pdf
editor: visual
---

## Data Cleaning, Manipulation, and Selection

Cape verde, Congos, Egypt, Gambia, Cote'dvore, Eswatini

```{r}
library(tidyverse, quietly=TRUE)
library(scales)


raw_data <- read.csv("yearly_progression.csv")[, -c(4)]
clean_1 <- raw_data %>%
  pivot_longer(cols=contains("..YR", ignore.case=FALSE), names_to="Year", 
               values_to="values") %>%
  rename(Region=Country.Name, `Region code`=Country.Code, 
         variables=Series.Name)%>%
  pivot_wider(., names_from=variables, values_from=values) %>%
  mutate(Year=str_sub(Year, 2, 5))%>%
  mutate_at(c('Year'), as.numeric)

equality1 <- clean_1[, 1:17]
health1 <- clean_1[, c(1:3, 18:22)]
visits1 <- clean_1[, c(1:3, 23:26, 32)]
purchases1 <- clean_1[, c(1:3, 27:31)]
participation1 <- clean_1[, c(34:40)]
```

## Exploring Equality

```{r}
recode.names <- c("Region", "Region code", "Year",  "apply for passport", 
                  "be head of household", "choose where to live", 
                  "get a job", "obtain a judgment of divorce", 
                  "open a bank account", "register a business", 
                  "sign a contract", "travel outside her home", 
                  "travel outside the country", "work at night", 
                  "work in job deemed dangerous", 
                  "work in an industrial job", "remarry")

colnames(equality1) <- recode.names
equality1[is.na(equality1)] = 3

equality <- equality1 %>%
  pivot_longer(cols=recode.names[4:17], names_to="Opinion", 
               values_to="Response") %>%
  mutate(across(c(Response), factor))
```



```{r, fig.width=15}
# Selecting only African Continents
continents <- read.csv("africa_clean_coords.csv")
africa_countries <- continents %>%
  filter(Continent == "Africa")

africa_map <- map_data("world", region=africa_countries$Country)


# Filter Data to Plot
all_response <- equality %>%
  filter(Year==2021, Opinion=="choose where to live")

# Data to Plot
plot_response <- africa_map %>%
  left_join(all_response, by=c("region"="Region"))

# Labels to use

country_labels <- africa_countries %>%
  left_join(plot_response, by=c("Country"="region")) %>%
  distinct(Country, .keep_all=TRUE) %>%
  select(-c("long", "lat")) %>%
  rename(lat=latitude, long=longitude)

# Map Plot

ggplot(plot_response, aes(x=long, y=lat, group=group))+
  coord_fixed(1)+
  geom_polygon(aes(fill=Response), color="#ffefdb")+
  scale_fill_manual(values=c("#0b84a5", "#f17853", "#ffb600"), 
                    labels=(c("No", "Yes", "No Data")), 
                    name=unique(all_response$Opinion)) +
  labs(title=paste0("A woman can ", {unique(all_response$Opinion)}, 
                    " the same way as a man, ", {unique(all_response$Year)}), 
       caption=paste0("Data Source: World Bank\n", "Last Update 2023/01/31\n", 
                      "Author: Midega George")) +
  ggrepel::geom_label_repel(aes(label= country_code), data= country_labels, 
                            size=2.5, max.overlaps = 25, label.size=0, 
                            arrow=arrow(length=unit(0.1, 'cm'))) +
  theme(axis.text=element_blank(),
        axis.ticks=element_blank(),
        axis.title=element_blank(),
        rect=element_blank(),
        axis.line = element_blank(),
        panel.border = element_blank(),
        panel.grid = element_blank(),
        panel.background = element_rect(fill = "#b1d3bc"),
        plot.title = element_text(hjust = 0.5),
        legend.position="right", legend.title=element_text(size=10), 
        legend.text=element_text(size=10))

ggsave("plots/live.png", bg="white", width=8)
```

